<%@page import="app.societywala.user.bo.UserRoleType"%>
<%@page import="app.societywala.common.bo.AttachementConstatnt"%>
<%@page import="app.societywala.user.bo.UserMaritalStatus"%>
<%@page import="app.societywala.user.bo.UserBloodGroupType"%>
<%@page import="app.societywala.user.bo.UserGenderType"%>
<%@page import="java.util.Map"%>
<%@page import="app.societywala.common.constants.CommonConstant"%>
<%@include file="../common/config.jsp" %>
<html>
<HEAD>
   <%@include file="../common/appmetaFile.jsp"%>
   <TITLE><spring:message code="common.title.label.product"/></TITLE>
   <!-- CSS Files -->  
   
   <style>
	.left_div
	{
		float: left;
		width: 30%;
		margin: 10px 5px 5px 5px;
	}
	
	.right_div
	{
		float: right;
		width: 60%;
		/*text-align : center;*/
		margin: 10px 5px 5px 20px; 
		/*margin-left:auto;
		margin-right:auto;*/
		right: auto;
	}
	</style>
   
</HEAD>

<%
String formSubmitAction=ctxPath+"/user/saveUserDetails.htm";
Map<String,Object> sessionCommonModelMap = (Map<String,Object>) session.getAttribute(CommonConstant.SESSION_COMMON_MODEL_MAP);
String pageRenderMode = (String)sessionCommonModelMap.get(CommonConstant.PAGE_RENDER_MODE);
UserBO userBO = (UserBO)request.getAttribute("userBO");
Boolean isAdminEdit = (Boolean)request.getAttribute("isAdminEdit");
%>

<body>

<div class="contentBg">
	<div class="center">
	<div class="content">	

	<%if(pageRenderMode.equals(CommonConstant.CREATE_MODE)) {%>
	<h1><spring:message code="user.register.form.header"/></h1>
	<p><spring:message code="user.register.form.subHeader"/></p>
	<%}else {%>
	<h1>Update Details</h1>
	<p><spring:message code="user.register.form.subHeader"/></p>
	<%}%>
	<div class="left_div">
	<%if(pageRenderMode.equals(CommonConstant.CREATE_MODE) == false && !isAdminEdit)
		{ 
			String userProfileImageThumb = ctxPath+"/images/common/en_US/avatar120x120.jpg";
			if(userBO.getProfileImageFileName() != null)
			 {
				 String directorySeperator = CommonConstant.DIRECTORY_SEPERATOR;
				 String finalAttachementDirectoryLocation = CommonConstant.USER_IMAGE_CONTEXT_URL+"/Thumbnail/"+ AttachementConstatnt.getEntityFolderName(AttachementConstatnt.USER_ENTITY) +"/" +userBO.getUserId()+"/"+AttachementConstatnt.getImageModuleFolderName(AttachementConstatnt.IMG_USER_PROFILE_MODULE);
				 userProfileImageThumb = finalAttachementDirectoryLocation + "/" + userBO.getProfileImageFileName();
			 }
	%>	
		
			<div class="photo">
   				<img alt="" src="<%=userProfileImageThumb%>" width="120px" height="120px">
			</div>
			<% if(pageRenderMode.equals(CommonConstant.EDIT_MODE)) {%>
			<div>
				<a href="javascript:getImageUploadCropPage('userProfileImageCropPopupForm' , 'userCropImageDiv' , '<%=AttachementConstatnt.USER_ENTITY %>' , '<%=userBO.getUserId()%>' ,'<%=AttachementConstatnt.IMG_USER_PROFILE_MODULE%>','<%=userBO.getUserId()%>');">Edit Image</a>
			</div>
			<% } // End of if Edit mode %>
		
	<%} // End of if statement Create Mode%>
	</div> <!-- End of left div -->
	
	<div class="right_div">
	<form:form cssClass="form" method="post" action="<%=formSubmitAction%>" commandName="userBO">
		<form:hidden path="userId"/>
		<form:hidden path="localeLanguageCode"/>
		<c:if test="${isAdminEdit ne true}">
			<form:hidden path="userLoginType"/>
		</c:if>
		
		<c:if test="${isAdminEdit eq true}">
		<div class="inputHolder">
			<form:label cssClass="label" path="userLoginType">User Login</form:label>
			<form:select path="userLoginType">
				<form:option value="<%=UserRoleType.MASTER_ADMIN %>">Admin</form:option>
				<form:option value="<%=UserRoleType.CONSULTANT %>">Consultant</form:option>
				<form:option value="<%=UserRoleType.DATA_ENTRY_OPERATOR %>">Data Entry Operator</form:option>
				<form:option value="<%=UserRoleType.NORMAL_USER%>">Normal User</form:option>
			</form:select>
		</div>
		</c:if>
		
		<div class="inputHolder">
			<form:label cssClass="label" path="nameTitle">Title</form:label>
			<form:input path="nameTitle" htmlEscape="true"/>					
		</div>
		
		<div class="inputHolder">
			<form:label cssClass="label" path="firstName">First Name</form:label>
			<div class="mandatoryMark">*</div>
			<form:input cssClass="mandatory"  path="firstName" htmlEscape="true"/>
			<div class="error mandatoryError">First Name is not mentioned</div>		
		</div>
		
		<div class="inputHolder">
			<form:label cssClass="label" path="middleName">Middle Name</form:label>
			<form:input path="middleName" htmlEscape="true"/>
		</div>
		
		<div class="inputHolder">
			<form:label cssClass="label" path="familyName">Family Name</form:label>
			<form:input path="familyName" htmlEscape="true"/>		
		</div>
	
		<div class="inputHolder">
			<form:label cssClass="label" path="fullName">Full Name</form:label>
			<div class="mandatoryMark">*</div>
			<form:input cssClass="mandatory"  path="fullName" htmlEscape="true"/>
			<div class="error mandatoryError">Full Name is not mentioned</div>		
		</div>
		 
		<div class="inputHolder">
			<form:label path="mobileNumber"><spring:message code="user.label.mobile.number"/></form:label>
			<div class="mandatoryMark">+</div>
			<form:input cssClass="number mobile" path="mobileNumber" htmlEscape="true" onblur="javascript:checkMobileNumberExists();"/>
			<div class="error mandatoryError"><spring:message code="user.error.mobile.number"/></div>		
			<div class="error numberError"><spring:message code="user.error.mobile.number.numeric"/></div>		
			<div class="error" id="errorDuplicateMobileNumber"><spring:message code="user.error.mobile.number.exists"/></div>
		</div>
		 
		<div class="inputHolder">
			<form:label path="emailId"><spring:message code="user.label.emailId"/></form:label>
			<div class="mandatoryMark">+</div>
			<form:input cssClass="email" path="emailId" htmlEscape="true" onblur="javascript:checkEmailIdExists();"/>
			<div class="error mandatoryError"><spring:message code="user.error.emailId"/></div>		
			<div class="error emailError"><spring:message code="user.error.invalid.emailId"/></div>		
			<div class="error" id="errorDuplicateEmailId"><spring:message code="user.error.emailId.exists"/></div>
		</div>
		
		<% if (pageRenderMode.equals(CommonConstant.CREATE_MODE) && !isAdminEdit) {%>
		<div class="inputHolder">
			<form:label path="password"><spring:message code="user.label.password"/></form:label>
			<div class="mandatoryMark">*</div>
			<form:password cssClass="mandatory" path="password" htmlEscape="true"/>
			<div class="error mandatoryError"><spring:message code="user.error.password"/></div>		
		</div>
		<div class="inputHolder">
			<label><spring:message code="user.label.confirm.password"/></label>
			<div class="mandatoryMark">*</div>
			<input type="password" class="mandatory" id="confirmPassword" name="confirmPassword" htmlEscape="true"/>
			<div class="error mandatoryError"><spring:message code="user.error.confirm.password"/></div>		
			<div class="error" id="errorPasswordNotMatch"><spring:message code="user.error.password.not.match"/></div>
		</div>
		
		<%} %>
		
		<div class="inputHolder">
			<form:label path="birthDate"><spring:message code="user.label.birthdate"/></form:label>
			<form:input cssClass="datepicker mandatory" path="birthDate" htmlEscape="true" />
			<div class="error mandatoryError">Birth date is required</div>
		</div>
		
		<div class="inputHolder">
			<form:label path="occupation">Occupation</form:label>
			<form:input path="occupation" htmlEscape="true"/>	
		</div>		
		
		<div class="inputHolder">
			<form:label path="genderType"><spring:message code="user.label.gender"/></form:label>
			<form:select path="genderType">
				<form:option value="${null}"></form:option>
				<form:option value="<%=UserGenderType.MALE_GENDER%>">Male</form:option>
				<form:option value="<%=UserGenderType.FEMALE_GENDER%>">FeMale</form:option>
			</form:select>	
		</div>
		
		<div class="inputHolder">
			<form:label path="bloodGroupType"><spring:message code="user.label.blood.group"/></form:label>
			<form:select path="bloodGroupType">
				<form:option value="${null}"></form:option>
				<form:option value="<%=UserBloodGroupType.O_PLUS%>">O+</form:option>
				<form:option value="<%=UserBloodGroupType.A_PLUS%>">A+</form:option>
				<form:option value="<%=UserBloodGroupType.B_PLUS%>">B+</form:option>
				<form:option value="<%=UserBloodGroupType.AB_PLUS%>">AB+</form:option>
				<form:option value="<%=UserBloodGroupType.O_MINUS%>">O-</form:option>
				<form:option value="<%=UserBloodGroupType.A_MINUS%>">A-</form:option>
				<form:option value="<%=UserBloodGroupType.B_MINUS%>">B-</form:option>
				<form:option value="<%=UserBloodGroupType.AB_MINUS%>">AB-</form:option>
			</form:select>	
		</div>
		
		<div class="inputHolder">
			<form:label path="maritalStatus"><spring:message code="user.label.marital.status"/></form:label>
			<form:select path="maritalStatus" onchange="javascript:showHideAnnivarsaryDate();">
				<form:option value="${null}"></form:option>
				<form:option value="<%=UserMaritalStatus.SINGLE%>">Single</form:option>
				<form:option value="<%=UserMaritalStatus.ENGAGED%>">Engaged</form:option>
				<form:option value="<%=UserMaritalStatus.MARRIED%>">Married</form:option>
				<form:option value="<%=UserMaritalStatus.SEPARATED%>">Separated</form:option>
				<form:option value="<%=UserMaritalStatus.WIDOWED%>">Widowed</form:option>
				<form:option value="<%=UserMaritalStatus.DIVORCED%>">Divorced</form:option>
			</form:select>	
		</div>
		
		
		<div class="inputHolder" id="anniversaryDateDiv" style="display: none;">
			<form:label path="anniversaryDate"><spring:message code="user.label.anniversary.date"/></form:label>
			<form:input cssClass="datepicker" path="anniversaryDate" htmlEscape="true" />	
		</div>

		<!-- 
		<div class="inputHolder">
			<form:label path="passportPhotoLocationURL"><spring:message code="user.label.passportPhoto"/></form:label> 
			<INPUT TYPE="FILE" NAME="field_name" VALUE="file_name">	
		</div>
		-->
		<div id="atLeastOneMsgDiv" style="display:inline-block; width:100%; text-align: center;">
			<div class="mandatoryMark">+</div>
			<spring:message code="user.form.note"/>
		</div>
		
		<div class="buttonPanel">
			<button type="submit" id="submitBtn">
				<spring:message code="common.button.save"/>
			</button>
		</div>
	</form:form>
	</div> <!-- End of right Div -->
	
	</div>
	</div>
</div>

<div id="userProfileImageCropPopupForm" class="popup_block">
	<div id="userCropImageDiv"></div>
	<input type="button" name="userCropImageSaveBtn" id="userCropImageSaveBtn" value="Save" onclick="javascript:saveUserProfileCropImage();"/>	
</div>

</body>
<!-- JS Files -->  
<script>
	var jMarriedMaritalStatusId = '<%=UserMaritalStatus.MARRIED%>';
</script>
<script type="text/javascript" src="<%=jsRoot%>/user/createNewUser.js?${Server_Token_Value}"></script>
<script>
	showHideDiv();
</script>
</html>